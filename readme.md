
## ~~Минуточку внимания!~~
~~Поскольку администрация ВКонтакте решила 15 февраля [закрыть доступ к API сообщений](https://vk.com/dev/messages_api), данный скрипт рискует потерять часть своего функционала. Пока идёт процесс прохождения модерации. Остаётся надеяться на лучшее :з~~

~~*UPD: уже была рассылка с напоминанием о возможности пройти модерацию, однако пока никаких новостей с конца января - "Ваш вопрос рассматривается."*~~

~~*UPD2: всё, API сообщений прикрыли, а ответа так и нет. Из scope исключил права на доступ к сообщениям - скрипт продолжит работу, но сообщения и всё связанное с ними ничего сохранить нельзя ¯\\\_(ツ)_/¯*~~

~~*UPD3: ради прохождения модерации пришлось вырезать и сохранение видео*~~

*UPD4: пока идёт переработка кода. Что из этого выйдет - понятия не имею, но думаю закончить работу к концу прохождения модерации*

## Установка зависимостей
```
pip3 install -r requirements.txt
```

Если Вы используете Windows ниже 10 версии, необходимо дополнительно установить пакет `colorama`:
```
pip3 install colorama
```

## Модули
С данным скриптом поставляется только "базовый" функционал. Расширяется с помощью [модулей](https://github.com/hikiko4ern/vk_dump_modules).

## CLI
Все доступные аргументы можно посмотреть при запуске с `--help`.

~~Для сохранения нескольких типов данных за один вызов необходимо указывать каждый тип отдельным аргументом `dump`.
Например, для сохранения фото и документов надо запускать `dump.py --dump photos --dump docs`.~~

**Пока аргумент `dump` не поддерживается.**

## Авторизация
Возможны два способа аутентификации - с помощью пары логин-пароль или токена.

Для входа по токену необходимо передать аргумент `token` при запуске:
```
python3 dump.py --token your_token_here
```

## Мультипоточная загрузка
Количество процессов, создаваемых для загрузки, по умолчанию равняется `4*потоки`.

При загрузке видео - числу, заданному в настройках, но не больше количества потоков.
Такое ограничение введено ввиду отсутствия смысла в спаме лишними процессами при загрузке больших по размеру видео (однако лимит всё же убирается через настройки).

## Поддерживаемые для сохранения данные
- [x] Фото
- [x] Документы
- [x] Диалоги (txt) и вложения (фото, документы, голосовые)
- [x] Вложения понравившихся постов (фото, документы)
- [x] Понравившиеся фотографии
- [ ] прочее, прочее, прочее ;)

## Исключение диалогов из сохранения
Для исключения диалога из списка сохраняемых необходимо дописать его id в конфиге `settings.ini`.

ID необходимо перечислять через запятую. Получить его можно, например, открыв диалог в разделе сообщений, тогда в URL вида `https://vk.com/im?sel=100` идентификатором будет являться кусок, идущий после `sel=`.

Пример с пропуском диалога с ID `100` и беседы `c60`:
```ini
[EXCLUDED_DIALOGS]
id = 100,c60
```

## Дозапись новых сообщений вместо перезаписывания
Если включена, при кэшировании будут получены не все сообщения, а только с ID больше сохранённого (последняя строка в файле).

## F.A.Q.
**Q: Ошибка vk_api.exceptions.AccessDenied: You don't have permissions to browse user's...**\
**A:** Попробуйте удалить файл `vk_config.v2.json` и переавторизироваться.

**Q: Ошибка RegexNotFoundError('Unable to extract %s' % _name)**\
**A:** Обновите `youtube_dl`: `pip3 install --upgrade youtube_dl`.
